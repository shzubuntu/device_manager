{"version":3,"file":"terminal.bundle.js","mappings":"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","sources":["webpack://device_manager/./static/js/terminal.js"],"sourcesContent":["// Load xterm resources with error handling\nconst loadXtermResources = () => {\n  try {\n    // Load xterm CSS\n    const xtermCss = document.createElement('link');\n    xtermCss.rel = 'stylesheet';\n    xtermCss.href = \"/static/xterm/xterm.css\";\n    xtermCss.onerror = () => console.error('Failed to load xterm CSS');\n    document.head.appendChild(xtermCss);\n\n    // Load xterm JS\n    const xtermScript = document.createElement('script');\n    xtermScript.src = \"/static/xterm/xterm.min.js\";\n    xtermScript.onerror = () => console.error('Failed to load xterm.js');\n    \n    xtermScript.onload = () => {\n      try {\n        // Verify Terminal is available\n        if (!window.Terminal) {\n          throw new Error('Terminal class not found after loading xterm.js');\n        }\n\n        // Load FitAddon\n        const fitAddonScript = document.createElement('script');\n        fitAddonScript.src = \"/static/xterm/xterm-addon-fit.min.js\";\n        fitAddonScript.onerror = () => console.error('Failed to load FitAddon');\n        \n        fitAddonScript.onload = () => {\n          try {\n            // Verify FitAddon is available\n            if (!window.FitAddon) {\n              throw new Error('FitAddon class not found after loading');\n            }\n\n            // Load WebLinksAddon\n            const webLinksAddonScript = document.createElement('script');\n            webLinksAddonScript.src = \"/static/xterm/xterm-addon-web-links.min.js\";\n            webLinksAddonScript.onerror = () => console.error('Failed to load WebLinksAddon');\n            \n            webLinksAddonScript.onload = () => {\n              // Verify WebLinksAddon is available\n              if (!window.WebLinksAddon) {\n                throw new Error('WebLinksAddon class not found after loading');\n              }\n              \n              console.log('All xterm resources loaded successfully');\n              document.dispatchEvent(new Event('xterm-ready'));\n            };\n            document.head.appendChild(webLinksAddonScript);\n          } catch (err) {\n            console.error('Error loading WebLinksAddon:', err);\n          }\n        };\n        document.head.appendChild(fitAddonScript);\n      } catch (err) {\n        console.error('Error loading FitAddon:', err);\n      }\n    };\n    document.head.appendChild(xtermScript);\n  } catch (err) {\n    console.error('Error loading xterm resources:', err);\n  }\n};\n\n// Initialize terminal when resources are loaded\ndocument.addEventListener('xterm-ready', () => {\n  try {\n    const { Terminal } = window;\n    const { FitAddon } = window;\n    const { WebLinksAddon } = window;\n\n    class DeviceTerminal {\n      constructor(deviceId) {\n        this.deviceId = deviceId;\n        console.log('Creating new Terminal instance');\n        this.terminal = new Terminal({\n          cursorBlink: true,\n          fontSize: 14,\n          fontFamily: 'Consolas, monospace',\n          theme: {\n            background: '#1e1e1e',\n            foreground: '#ffffff'\n          }\n        });\n        \n        console.log('Terminal instance created:', this.terminal);\n        console.log('Terminal.onData exists:', typeof this.terminal.onData === 'function');\n        \n        this.fitAddon = new FitAddon();\n        this.webLinksAddon = new WebLinksAddon();\n        \n        this.terminal.loadAddon(this.fitAddon);\n        this.terminal.loadAddon(this.webLinksAddon);\n        \n        this.socket = null;\n        this.connected = false;\n      }\n\n      init(containerId) {\n        this.terminal.open(document.getElementById(containerId));\n        this.fitAddon.fit();\n        \n        // Handle window resize\n        window.addEventListener('resize', () => this.fitAddon.fit());\n        \n        // Setup terminal input handling\n        this.terminal.onData((data) => {\n          if (this.connected && this.socket) {\n            try {\n              this.socket.send(JSON.stringify({\n                type: 'input',\n                data: data\n              }));\n            } catch (err) {\n              console.error('Error sending input:', err);\n            }\n          }\n        });\n        \n        // Connect to WebSocket\n        this.connect();\n      }\n\n      connect() {\n        this.socket = new WebSocket(\n          `ws://${window.location.host}/ws/ssh/${this.deviceId}/`\n        );\n\n        this.socket.onopen = () => {\n          this.connected = true;\n          this.terminal.writeln('\\r\\n\\x1b[32mConnected to device terminal\\x1b[0m\\r\\n');\n          \n          // Send auth message\n          this.socket.send(JSON.stringify({\n            type: 'auth',\n            device_id: this.deviceId\n          }));\n        };\n\n        this.socket.onmessage = (event) => {\n          const data = JSON.parse(event.data);\n          \n          switch (data.type) {\n            case 'output':\n              this.terminal.write(data.data);\n              break;\n              \n            case 'status':\n              this.terminal.writeln(`\\r\\n\\x1b[33m${data.message}\\x1b[0m\\r\\n`);\n              break;\n              \n            case 'error':\n              this.terminal.writeln(`\\r\\n\\x1b[31mError: ${data.message}\\x1b[0m\\r\\n`);\n              break;\n              \n            default:\n              console.warn('Unknown message type:', data.type);\n          }\n        };\n\n        this.socket.onclose = () => {\n          this.connected = false;\n          this.terminal.writeln('\\r\\n\\x1b[31mConnection closed\\x1b[0m\\r\\n');\n        };\n\n        this.socket.onerror = (error) => {\n          this.connected = false;\n          this.terminal.writeln(`\\r\\n\\x1b[31mConnection error: ${error.message}\\x1b[0m\\r\\n`);\n        };\n      }\n\n      disconnect() {\n        if (this.socket) {\n          this.socket.close();\n        }\n      }\n    } // End of DeviceTerminal class\n\n    // Initialize terminal when DOM is ready\n    document.addEventListener('DOMContentLoaded', () => {\n      try {\n        console.log('DOMContentLoaded event fired');\n        \n        const terminalElement = document.getElementById('terminal');\n        if (!terminalElement) {\n          throw new Error('Terminal element not found');\n        }\n\n        const deviceId = terminalElement.dataset.deviceId;\n        if (!deviceId) {\n          throw new Error('Device ID not found');\n        }\n\n        console.log('Creating DeviceTerminal instance for device:', deviceId);\n        const terminal = new DeviceTerminal(deviceId);\n        \n        console.log('Initializing terminal...');\n        terminal.init('terminal');\n        console.log('Terminal initialization complete');\n        \n        // Verify terminal methods\n        if (!terminal.terminal || typeof terminal.terminal.on !== 'function') {\n          throw new Error('Terminal instance is not properly initialized');\n        }\n      } catch (err) {\n        console.error('Error initializing terminal:', err);\n        // Display error to user\n        const errorElement = document.createElement('div');\n        errorElement.style.color = 'red';\n        errorElement.style.padding = '20px';\n        errorElement.textContent = `Terminal initialization error: ${err.message}`;\n        document.body.appendChild(errorElement);\n      }\n    });\n  } catch (err) {\n    console.error('Error in xterm-ready handler:', err);\n  }\n}); // End of xterm-ready event listener\n\n// Start loading resources\nloadXtermResources();\n"],"names":["document","addEventListener","Terminal","window","FitAddon","WebLinksAddon","DeviceTerminal","deviceId","_classCallCheck","this","console","log","terminal","cursorBlink","fontSize","fontFamily","theme","background","foreground","onData","fitAddon","webLinksAddon","loadAddon","socket","connected","key","value","containerId","_this","open","getElementById","fit","data","send","JSON","stringify","type","err","error","connect","_this2","WebSocket","concat","location","host","onopen","writeln","device_id","onmessage","event","parse","write","message","warn","onclose","onerror","close","terminalElement","Error","dataset","init","on","errorElement","createElement","style","color","padding","textContent","body","appendChild","xtermCss","rel","href","head","xtermScript","src","onload","fitAddonScript","webLinksAddonScript","dispatchEvent","Event","loadXtermResources"],"sourceRoot":""}